The feature set of this wiki seems to be reasonably stable and complete with the recent addition of simple lists. So it is time again to think about RewritingThisWiki in a "real language". How about ObjectiveCaml?

While reading about ImplementingTheSingleNewline, I thought about describing the syntax of the markup as a formal language. We can use this syntax to discuss alternatives and to guide any implementation.

----

= Current Syntax

Even though we are currently processing the markup '''paragraph by paragraph''' where paragraphs are delimited by double newlines, I want to describe the syntax as if we were processing it '''line by line'''. The advantage of doing so will become clear in a moment.

I am also only concerned with the block markup, as the inline markup should be complete within a single block (should not span blocks) and would require processing the input in smaller units.

So the '''tokens''' of our language are actually the different block markup types. Here is a list of the tokens and a regular expression that can be used to recognize it.

   empty          ^$       or maybe  ^\s*$
   head           ^={1,4}
   quote          ^"\s*
   item           ^[*#]\s+
   preformatted   ^\s+
   rule           ^-{4,}
   voice          ^>{1,8}
   text           .

The syntax in EBNF for the markup is as follows:

   WikiPage      = { Heading | Paragraph | List | Quote | Verbatim |
		     VoiceChange | Rule }.
   Heading       = head Blank.
   Paragraph     = text {text} Blank.
   Quote         = quote Blank.          *
   List          = ListItem {ListItem}.
   ListItem      = item Blank.           *
   Verbatim      = VerbatimBlock {VerbatimBlock}.
   VerbatimBlock = preformatted {preformatted} Blank.
   VoiceChange   = voice.
   Rule          = rule.
   Blank         = empty {empty}.        *

where '''{ ... }''' means zero or more repetitions and the vertical bar '''|''' separates alternatives.

----

= Better, more intuitive Syntax

If we introduce a new token '''indented''', we can quite easily extend the syntax above to include everything that ImplementingTheSingleNewline would have achieved. We only need changes to three lines marked with a '''*''' above:

   WikiPage      = { Heading | Paragraph | List | Quote | Verbatim |
		     VoiceChange | Rule }.
   Heading       = head Blank.
   Paragraph     = text {text} Blank.
   Quote         = quote ( {indented} | {text} ) Blank.
   List          = ListItem {ListItem}.
   ListItem      = item {indented} Blank.
   Verbatim      = VerbatimBlock {VerbatimBlock}.
   VerbatimBlock = preformatted {preformatted} Blank.
   VoiceChange   = voice.
   Rule          = rule.
   Blank         = {empty}.

Unfortunately, '''indented''' does not have a simple regular expression because it depends on context. It is meant to recognize the continuation lines for list items or quotations so we can write something like this:

   * This is a list item
     that is continued here.
   * Second list item.

Both languages fall into the LL(1) category and can be easily recognized by a recursive descent parser with a single symbol (line) of look-ahead.